<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vocab Master</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Martian+Mono:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --duo-green: #58cc02;
            --duo-green-shadow: #46a302;
            --duo-red: #ff4b4b;
            --duo-red-shadow: #d42c2c;
            --duo-blue: #1cb0f6;
            --duo-blue-shadow: #1899d6;
            --duo-gray: #e5e5e5;
            --duo-gray-text: #afafaf;
            --duo-dark: #3c3c3c;
            --bg-color: #fff;
            --font-main: 'Martian Mono', monospace;
        }

        * {
            box-sizing: border-box;
            touch-action: manipulation; /* Improves touch response on mobile */
        }

        body {
            margin: 0;
            padding: 0;
            font-family: var(--font-main);
            background-color: var(--bg-color);
            color: var(--duo-dark);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* --- Layout --- */
        .container {
            flex: 1;
            display: flex;
            flex-direction: column;
            max-width: 600px; /* Mobile first logic, constrained width for desktop */
            width: 100%;
            margin: 0 auto;
            padding: 20px;
            position: relative;
        }

        /* --- Welcome Screen --- */
        #welcome-screen, #end-screen {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100%;
            text-align: center;
        }

        h1 {
            font-weight: 800;
            color: var(--duo-green);
            margin-bottom: 2rem;
            font-size: 2rem;
        }

        input[type="text"] {
            font-family: var(--font-main);
            padding: 15px;
            border: 2px solid var(--duo-gray);
            border-radius: 15px;
            font-size: 1.2rem;
            width: 80%;
            margin-bottom: 20px;
            text-align: center;
            outline: none;
            transition: border-color 0.2s;
        }

        input[type="text"]:focus {
            border-color: var(--duo-blue);
        }

        /* --- Quiz Screen --- */
        #quiz-screen {
            display: none;
            flex-direction: column;
            height: 100%;
        }

        .header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 20px;
        }

        .progress-bar-bg {
            background-color: var(--duo-gray);
            height: 16px;
            border-radius: 8px;
            flex-grow: 1;
            margin-left: 15px;
            overflow: hidden;
        }

        .progress-bar-fill {
            background-color: var(--duo-green);
            height: 100%;
            width: 0%; /* JS will update this */
            transition: width 0.5s ease;
            border-radius: 8px;
        }

        .word-status {
            font-size: 0.8rem;
            color: var(--duo-blue);
            font-weight: 600;
            margin-bottom: 10px;
            min-height: 20px;
        }

        .question-box {
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 30px;
            font-weight: 400;
        }

        .blank {
            display: inline-block;
            border-bottom: 2px solid var(--duo-dark);
            width: 80px;
            text-align: center;
            color: transparent;
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin-bottom: auto; /* Pushes everything else down */
        }

        /* --- Buttons --- */
        .btn {
            font-family: var(--font-main);
            background-color: #fff;
            border: 2px solid var(--duo-gray);
            border-bottom: 4px solid var(--duo-gray);
            border-radius: 16px;
            padding: 15px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.1s;
            text-align: left;
            color: var(--duo-dark);
            width: 100%;
        }

        .btn:active {
            transform: translateY(2px);
            border-bottom-width: 2px;
        }

        .btn.selected {
            background-color: #ddf4ff;
            border-color: var(--duo-blue);
            border-bottom-color: var(--duo-blue-shadow);
            color: var(--duo-blue-shadow);
        }

        .btn.correct {
            background-color: #d7ffb8;
            border-color: var(--duo-green);
            border-bottom-color: var(--duo-green-shadow);
            color: var(--duo-green-shadow);
        }

        .btn.wrong {
            background-color: #ffdfe0;
            border-color: var(--duo-red);
            border-bottom-color: var(--duo-red-shadow);
            color: var(--duo-red-shadow);
        }

        .btn-primary {
            background-color: var(--duo-green);
            color: white;
            border-color: var(--duo-green);
            border-bottom-color: var(--duo-green-shadow);
            text-align: center;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .btn-primary:hover {
            background-color: #61e002;
        }

        /* --- Feedback Footer --- */
        .footer-area {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: #fff; /* Default hidden bg */
            border-top: 2px solid transparent;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            transform: translateY(100%);
            transition: transform 0.3s cubic-bezier(0.18, 0.89, 0.32, 1.28);
            z-index: 10;
        }

        .footer-area.show {
            transform: translateY(0);
        }

        .footer-area.correct {
            background-color: #d7ffb8;
            border-color: #b7e890;
            color: var(--duo-green-shadow);
        }

        .footer-area.wrong {
            background-color: #ffdfe0;
            border-color: #ffc1c1;
            color: var(--duo-red-shadow);
        }

        .feedback-content {
            display: flex;
            flex-direction: column;
            max-width: 600px;
            width: 100%;
            margin: 0 auto;
        }

        .feedback-title {
            font-weight: 800;
            font-size: 1.2rem;
            margin-bottom: 5px;
        }

        .feedback-text {
            font-size: 0.95rem;
            margin-bottom: 15px;
        }

        /* Desktop View Adjustments */
        @media (min-width: 768px) {
            .options-grid {
                grid-template-columns: 1fr 1fr;
            }
            .container {
                justify-content: center;
            }
            #quiz-screen {
                justify-content: center;
            }
            .question-box {
                font-size: 1.4rem;
            }
        }
    </style>
</head>
<body>

    <div class="container">
        <div id="welcome-screen">
            <h1>VOCAB MASTER</h1>
            <p>50 Words. 4 Levels of Mastery.</p>
            <br>
            <input type="text" id="username-input" placeholder="Enter your name">
            <button class="btn btn-primary" id="start-btn">Start Learning</button>
        </div>

        <div id="quiz-screen">
            <div class="header-bar">
                <div style="font-weight: 800; color: var(--duo-gray-text);">X</div>
                <div class="progress-bar-bg">
                    <div class="progress-bar-fill" id="progress-bar"></div>
                </div>
            </div>
            
            <div class="word-status" id="word-status"></div>
            <div class="question-box" id="question-text">
                Loading...
            </div>

            <div class="options-grid" id="options-container">
                </div>
        </div>

        <div id="end-screen" style="display: none;">
            <h1>CONGRATULATIONS!</h1>
            <h2 id="congrats-name" style="color: var(--duo-blue);"></h2>
            <p>You have cleared the list!</p>
            <button class="btn btn-primary" onclick="location.reload()">Play Again</button>
        </div>
    </div>

    <div class="footer-area" id="footer">
        <div class="feedback-content">
            <div class="feedback-title" id="feedback-title">Correct!</div>
            <div class="feedback-text" id="feedback-definition">Definition goes here.</div>
            <button class="btn btn-primary" id="next-btn">CONTINUE</button>
        </div>
    </div>

    <script>
        // --- DATA ---
        // Simplified structure based on user list.
        const rawData = [
            { w: "Abate", d: "To reduce, lessen", s: "The rain poured down for a while, then abated." },
            { w: "Aberration", d: "Something that differs from the norm", s: "The sudden drop in temperature was an aberration for this time of year." },
            { w: "Abhor", d: "To hate, detest", s: "Because he always wound up kicking himself in the head, Oswald began to abhor the sport." },
            { w: "Acumen", d: "Keen insight", s: "Because of his mathematical acumen, Larry was able to figure out problems instantly." },
            { w: "Adamant", d: "Impervious, immovable, unyielding", s: "Though public pressure was intense, the President remained adamant about his proposal." },
            { w: "Aesthetic", d: "Artistic, related to appreciation of beauty", s: "We hired Susan as our interior decorator because she has such a fine aesthetic sense." },
            { w: "Alacrity", d: "Eagerness, speed", s: "When his mother asked him to set the table he did so with alacrity." },
            { w: "Ameliorate", d: "To improve", s: "The tense situation was ameliorated when Sam proposed a solution everyone could agree upon." },
            { w: "Anachronistic", d: "Being out of correct chronological order", s: "Saying the Pyramids were built after the Titanic sank is anachronistic." },
            { w: "Anomaly", d: "Something that does not fit into the normal order", s: "That rip in the space-time continuum is certainly a spatial anomaly." },
            { w: "Antipathy", d: "A strong dislike, repugnance", s: "I know you love me, but because you are a liar, I feel nothing but antipathy for you." },
            { w: "Arcane", d: "Obscure, secret, known only by a few", s: "The professor is an expert in arcane Lithuanian literature." },
            { w: "Ascetic", d: "Practicing restraint, usually religious", s: "The priest lives an ascetic life devoid of television and savory foods." },
            { w: "Assiduous", d: "Hard-working, diligent", s: "The construction workers erected the skyscraper during two years of assiduous labor." },
            { w: "Banal", d: "Dull, commonplace", s: "The client rejected our proposal because they found our presentation banal." },
            { w: "Benevolent", d: "Marked by goodness or doing good", s: "Police officers should be commended for their benevolent service." },
            { w: "Boisterous", d: "Loud and full of energy", s: "The candidate won the vote after giving several boisterous speeches." },
            { w: "Brazen", d: "Excessively bold, brash", s: "Critics condemned the novelistâ€™s brazen attempt to plagiarize." },
            { w: "Brusque", d: "Short, abrupt, dismissive", s: "The captainâ€™s brusque manner offended the passengers." },
            { w: "Cacophony", d: "Tremendous noise, disharmonious sound", s: "The elementary school orchestra created a cacophony at the recital." },
            { w: "Candor", d: "Honesty, frankness", s: "We were surprised by the candor of the mayorâ€™s speech because he is usually evasive." },
            { w: "Capricious", d: "Subject to whim, fickle", s: "The young girlâ€™s capricious tendencies made it difficult for her to focus." },
            { w: "Caustic", d: "Bitter, biting, acidic", s: "The politicians exchanged caustic insults for over an hour." },
            { w: "Clandestine", d: "Secret", s: "Sophie actually went to meet Joseph for a clandestine liaison." },
            { w: "Cogent", d: "Intellectually convincing", s: "Ireneâ€™s arguments were so cogent that I could not resist them." },
            { w: "Concomitant", d: "Accompanying in a subordinate fashion", s: "His dislike of hard work carried with it a concomitant lack of funds." },
            { w: "Convivial", d: "Characterized by feasting, drinking, merriment", s: "The restaurantâ€™s convivial atmosphere put me immediately at ease." },
            { w: "Credulity", d: "Readiness to believe", s: "His credulity made him an easy target for con men." },
            { w: "Dearth", d: "A lack, scarcity", s: "An eager reader, she was dismayed by the dearth of classic books." },
            { w: "Debacle", d: "A disastrous failure, disruption", s: "The fireworks show turned into a debacle when they started firing randomly." },
            { w: "Deleterious", d: "Harmful", s: "She experienced the deleterious effects of running without stretching." },
            { w: "Despot", d: "One who has total power and rules brutally", s: "The despot issued a death sentence for anyone who disobeyed." },
            { w: "Didactic", d: "Intended to instruct", s: "She wrote up a didactic document showing new employees how to handle customers." },
            { w: "Disparate", d: "Sharply differing", s: "Having widely varying interests, the students had disparate responses." },
            { w: "Ebullient", d: "Extremely lively, enthusiastic", s: "She became ebullient upon receiving an acceptance letter." },
            { w: "Eclectic", d: "Consisting of a diverse variety of elements", s: "That bar attracts an eclectic crowd: lawyers, artists, and clowns." },
            { w: "Egregious", d: "Extremely bad", s: "The student was punished for his egregious behavior in the cafeteria." },
            { w: "Eloquent", d: "Expressive, articulate, moving", s: "The priest gave such an eloquent sermon that most churchgoers were crying." },
            { w: "Enervate", d: "To weaken, exhaust", s: "Writing these sentences enervates me so much that I will have to take a nap." },
            { w: "Ephemeral", d: "Short-lived, fleeting", s: "Her 'forever' was only ephemeral; she left me after one week." },
            { w: "Esoteric", d: "Understood by only a select few", s: "Even advanced students cannot understand the physicistâ€™s esoteric theories." },
            { w: "Evanescent", d: "Fleeting, momentary", s: "My joy was evanescent because I discovered I would have to work longer hours." },
            { w: "Fastidious", d: "Meticulous, demanding", s: "Mark is so fastidious that the project always seems imperfect to him." },
            { w: "Furtive", d: "Secretive, sly", s: "Janeâ€™s placement of her drugs in her sock drawer was not as furtive as she thought." },
            { w: "Garrulous", d: "Talkative, wordy", s: "Some talk show hosts are so garrulous that guests canâ€™t get a word in." },
            { w: "Gregarious", d: "Drawn to the company of others, sociable", s: "If youâ€™re not gregarious, I donâ€™t know why you would want to go to a singles party!" },
            { w: "Hackneyed", d: "Unoriginal, trite", s: "A girl can only hear 'I love you' so many times before it sounds hackneyed." },
            { w: "Iconoclast", d: "One who attacks common beliefs", s: "Jane seems to be an iconoclast rather than an activist." },
            { w: "Impetuous", d: "Rash; hastily done", s: "Hildaâ€™s hasty slaying of the king was an impetuous action." },
            { w: "Incessant", d: "Unending", s: "The incessant rain kept us indoors for two days." }
        ];

        // --- STATE MANAGEMENT ---
        let appState = {
            user: "",
            words: [], // { id, word, def, sentence, correctCount, consecutive, isDeleted }
            currentQuestion: null, // { wordObj, distractors, maskedSentence }
            isWaitingForNext: false
        };

        // --- SOUND CONTROLLER (Web Audio API) ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        
        const playSound = (type) => {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            
            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            
            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            
            if (type === 'correct') {
                // High ding
                osc.type = 'sine';
                osc.frequency.setValueAtTime(500, audioCtx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(1000, audioCtx.currentTime + 0.1);
                gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.5);
            } else if (type === 'wrong') {
                // Low buzz
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(150, audioCtx.currentTime);
                osc.frequency.linearRampToValueAtTime(100, audioCtx.currentTime + 0.3);
                gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.4);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.4);
            } else if (type === 'finish') {
                 // Victory Arpeggio
                const now = audioCtx.currentTime;
                [523.25, 659.25, 783.99, 1046.50].forEach((freq, i) => {
                    const o = audioCtx.createOscillator();
                    const g = audioCtx.createGain();
                    o.connect(g);
                    g.connect(audioCtx.destination);
                    o.frequency.value = freq;
                    o.type = 'triangle';
                    g.gain.setValueAtTime(0.2, now + i*0.1);
                    g.gain.exponentialRampToValueAtTime(0.001, now + i*0.1 + 0.5);
                    o.start(now + i*0.1);
                    o.stop(now + i*0.1 + 0.5);
                });
            }
        };

        // --- INITIALIZATION ---
        function init() {
            // Initialize word list with stats
            appState.words = rawData.map((item, index) => ({
                id: index,
                word: item.w,
                def: item.d,
                sentence: item.s,
                correctCount: 0,
                consecutive: 0,
                isDeleted: false
            }));

            // DOM Elements
            const startBtn = document.getElementById('start-btn');
            const nextBtn = document.getElementById('next-btn');
            const usernameInput = document.getElementById('username-input');

            startBtn.addEventListener('click', startGame);
            nextBtn.addEventListener('click', nextQuestion);

            // Keydown listener for Enter
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    if (appState.isWaitingForNext) {
                        nextQuestion();
                    } else if (document.getElementById('welcome-screen').style.display !== 'none') {
                        startGame();
                    }
                }
            });
        }

        function startGame() {
            const input = document.getElementById('username-input');
            const name = input.value.trim() || "Learner";
            appState.user = name;

            document.getElementById('welcome-screen').style.display = 'none';
            document.getElementById('quiz-screen').style.display = 'flex';
            
            generateQuestion();
        }

        // --- GAME LOGIC ---
        function generateQuestion() {
            // Filter available words (not deleted)
            const availablePool = appState.words.filter(w => !w.isDeleted);

            if (availablePool.length === 0) {
                showEndScreen();
                return;
            }

            // Pick a random word
            // Improved selection: Prioritize words seen less often or maintained words to verify
            const targetWord = availablePool[Math.floor(Math.random() * availablePool.length)];

            // Create Masked Sentence
            // Regex to find the word, case insensitive, and masking it
            const regex = new RegExp(targetWord.word.substring(0, 4), 'i'); // Match first 4 chars to handle tenses loosely
            const maskedSentence = targetWord.sentence.replace(regex, "_______");

            // Pick 3 distractors
            const distractors = [];
            while (distractors.length < 3) {
                const r = rawData[Math.floor(Math.random() * rawData.length)];
                if (r.w !== targetWord.word && !distractors.includes(r.w)) {
                    distractors.push(r.w);
                }
            }

            // Shuffle options
            const options = [...distractors, targetWord.word].sort(() => Math.random() - 0.5);

            appState.currentQuestion = {
                wordObj: targetWord,
                maskedSentence: maskedSentence,
                options: options
            };

            renderQuestion();
        }

        function renderQuestion() {
            appState.isWaitingForNext = false;

            // Reset UI
            document.getElementById('footer').classList.remove('show', 'correct', 'wrong');
            const optionsContainer = document.getElementById('options-container');
            optionsContainer.innerHTML = '';
            
            // Status Indicator
            const w = appState.currentQuestion.wordObj;
            const statusEl = document.getElementById('word-status');
            if (w.correctCount >= 3) {
                statusEl.innerHTML = "ðŸ”¥ MASTERED (Next correct removes it)";
                statusEl.style.color = "orange";
            } else if (w.consecutive >= 2) {
                statusEl.innerHTML = "âœ¨ MAINTAINED";
                statusEl.style.color = "var(--duo-blue)";
            } else {
                statusEl.innerHTML = "ðŸŒ± NEW / LEARNING";
                statusEl.style.color = "var(--duo-gray-text)";
            }

            // Sentence
            document.getElementById('question-text').innerHTML = appState.currentQuestion.maskedSentence;

            // Options
            appState.currentQuestion.options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'btn';
                btn.innerText = opt;
                btn.onclick = () => handleAnswer(btn, opt);
                optionsContainer.appendChild(btn);
            });

            // Update Progress Bar
            updateProgressBar();
        }

        function handleAnswer(btnElement, selectedOption) {
            if (appState.isWaitingForNext) return; // Prevent multiple clicks

            const correctWord = appState.currentQuestion.wordObj.word;
            const isCorrect = selectedOption === correctWord;
            
            // UI Update
            const allBtns = document.querySelectorAll('.options-grid .btn');
            allBtns.forEach(b => {
                b.disabled = true;
                if (b.innerText === correctWord) b.classList.add('correct');
                else if (b === btnElement && !isCorrect) b.classList.add('wrong');
            });

            // Logic Update
            updateWordStats(isCorrect);

            // Feedback Footer
            const footer = document.getElementById('footer');
            const title = document.getElementById('feedback-title');
            const text = document.getElementById('feedback-definition');
            
            footer.classList.remove('correct', 'wrong');
            if (isCorrect) {
                footer.classList.add('correct');
                title.innerText = "Nicely done!";
                playSound('correct');
            } else {
                footer.classList.add('wrong');
                title.innerText = "Correct answer: " + correctWord;
                playSound('wrong');
            }

            text.innerHTML = `<strong>Definition:</strong> ${appState.currentQuestion.wordObj.def}`;
            footer.classList.add('show');
            
            appState.isWaitingForNext = true;
        }

        function updateWordStats(isCorrect) {
            const word = appState.currentQuestion.wordObj;

            if (isCorrect) {
                word.consecutive++;
                word.correctCount++;
                
                // Rule 3: 4th time right -> Delete
                if (word.correctCount >= 4) {
                    word.isDeleted = true;
                }
            } else {
                // Rule 4: Wrong -> Reset consecutive, but not total count
                word.consecutive = 0;
            }
        }

        function nextQuestion() {
            if (!appState.isWaitingForNext) return;
            generateQuestion();
        }

        function updateProgressBar() {
            // Calculate progress based on deleted words
            const total = appState.words.length;
            const deleted = appState.words.filter(w => w.isDeleted).length;
            const percentage = (deleted / total) * 100;
            document.getElementById('progress-bar').style.width = percentage + '%';
        }

        function showEndScreen() {
            document.getElementById('quiz-screen').style.display = 'none';
            document.getElementById('end-screen').style.display = 'flex';
            document.getElementById('congrats-name').innerText = appState.user;
            playSound('finish');
        }

        // Run
        init();

    </script>
</body>
</html>
