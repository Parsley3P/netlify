<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vocab Master - Duolingo Style</title>
    <style>
        :root {
            --duo-green: #58cc02;
            --duo-green-dark: #46a302;
            --duo-red: #ff4b4b;
            --duo-red-dark: #ea2b2b;
            --duo-blue: #1cb0f6;
            --duo-blue-dark: #1899d6;
            --duo-gray: #e5e5e5;
            --duo-text: #4b4b4b;
            --duo-text-light: #777;
            --bg-color: #ffffff;
        }

        * {
            box-sizing: border-box;
            font-family: 'Nunito', 'Segoe UI', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            margin: 0;
            padding: 0;
            background-color: #f7f7f7; /* Light grey bg for desktop */
            display: flex;
            justify-content: center;
            min-height: 100vh;
        }

        /* Mobile First Container */
        #app {
            background-color: var(--bg-color);
            width: 100%;
            max-width: 600px;
            display: flex;
            flex-direction: column;
            position: relative;
            box-shadow: 0 0 20px rgba(0,0,0,0.05);
            height: 100vh; /* Full viewport height on mobile */
        }

        /* Header */
        header {
            padding: 16px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .progress-container {
            flex-grow: 1;
            height: 16px;
            background-color: var(--duo-gray);
            border-radius: 8px;
            margin-right: 15px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background-color: var(--duo-green);
            width: 0%;
            transition: width 0.5s ease;
            border-radius: 8px;
        }

        .stats {
            color: var(--duo-green);
            font-weight: 800;
            font-size: 1.2rem;
        }

        /* Main Content */
        main {
            flex: 1;
            padding: 20px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            overflow-y: auto;
        }

        h2 {
            color: var(--duo-text);
            font-size: 1.5rem;
            margin-bottom: 30px;
        }

        .definition-text {
            font-weight: 600;
            color: var(--duo-text);
            line-height: 1.5;
        }

        /* Options Grid */
        .options-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
        }

        @media (min-width: 480px) {
            .options-grid {
                grid-template-columns: 1fr 1fr; /* 2 cols on larger screens */
            }
        }

        .option-btn {
            background: #fff;
            border: 2px solid var(--duo-gray);
            border-bottom-width: 4px;
            border-radius: 12px;
            padding: 15px;
            font-size: 1.1rem;
            color: var(--duo-text);
            cursor: pointer;
            transition: all 0.1s;
            text-align: center;
        }

        .option-btn:active {
            transform: translateY(2px);
            border-bottom-width: 2px;
        }

        .option-btn.selected {
            background-color: #ddf4ff;
            border-color: var(--duo-blue);
            color: var(--duo-blue-dark);
        }

        .option-btn.correct {
            background-color: #d7ffb8;
            border-color: var(--duo-green);
            color: var(--duo-green-dark);
        }

        .option-btn.wrong {
            background-color: #ffdfe0;
            border-color: var(--duo-red);
            color: var(--duo-red-dark);
        }

        /* Bottom Action Sheet (Feedback) */
        .bottom-sheet {
            position: fixed; /* Fixed to stick to bottom */
            bottom: 0;
            left: 50%; /* Center horizontally */
            transform: translateX(-50%); /* Center adjustment */
            width: 100%;
            max-width: 600px; /* Match app width */
            padding: 20px;
            border-top: 2px solid transparent;
            display: none;
            flex-direction: column;
            z-index: 100;
        }

        .bottom-sheet.correct {
            background-color: #d7ffb8;
            color: var(--duo-green-dark);
            display: flex;
        }

        .bottom-sheet.wrong {
            background-color: #ffdfe0;
            color: var(--duo-red-dark);
            display: flex;
        }

        .feedback-header {
            font-weight: 800;
            font-size: 1.5rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .feedback-text {
            font-size: 1rem;
            margin-bottom: 20px;
            color: var(--duo-text);
        }

        .example-sentence {
            font-style: italic;
            background: rgba(255,255,255,0.5);
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        /* Buttons */
        .action-btn {
            width: 100%;
            padding: 14px;
            border-radius: 12px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            border: none;
            border-bottom: 4px solid;
            cursor: pointer;
            font-size: 1rem;
        }

        .check-btn {
            background-color: var(--duo-green);
            color: white;
            border-color: var(--duo-green-dark);
            margin-top: auto; /* Push to bottom if in main flow */
        }
        
        .check-btn:disabled {
            background-color: var(--duo-gray);
            border-color: #bfbfbf;
            color: #afafaf;
            cursor: not-allowed;
        }

        .continue-btn {
            background-color: var(--duo-green); /* Default for correct */
            color: white;
            border-color: var(--duo-green-dark);
        }

        .bottom-sheet.wrong .continue-btn {
            background-color: var(--duo-red);
            border-color: var(--duo-red-dark);
        }

        /* Mastery Badge */
        .badge {
            font-size: 0.8rem;
            padding: 2px 8px;
            border-radius: 10px;
            margin-left: 5px;
            text-transform: uppercase;
        }
        .badge-new { background: #eee; color: #777; }
        .badge-maintained { background: #ffbd00; color: #fff; }
        .badge-mastered { background: var(--duo-blue); color: #fff; }

        /* Mobile specific adjustments */
        @media (max-height: 600px) {
            h2 { font-size: 1.2rem; margin-bottom: 15px; }
            .option-btn { padding: 10px; }
        }
    </style>
</head>
<body>

<div id="app">
    <header>
        <div class="progress-container">
            <div class="progress-bar" id="mastery-bar"></div>
        </div>
        <div class="stats">
            <span id="remaining-count">0</span> Left
        </div>
    </header>

    <main id="quiz-area">
        <h2>Select the correct word</h2>
        
        <div style="margin-bottom: 20px;">
            <p class="definition-text" id="question-text">...</p>
        </div>

        <div class="options-grid" id="options-container">
            </div>

        <div style="flex: 1"></div> <div style="padding: 20px; width: 100%;">
            <button id="check-btn" class="action-btn check-btn" disabled>Check</button>
        </div>
    </main>

    <div id="feedback-sheet" class="bottom-sheet">
        <div class="feedback-header" id="feedback-title"></div>
        <div class="feedback-text" id="feedback-detail"></div>
        <div class="example-sentence" id="feedback-example"></div>
        <button id="continue-btn" class="action-btn continue-btn">Continue</button>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>

<script>
    // --- 1. Data Initialization ---
    const rawData = [
        {w:"foster", p:"v.", d:"to stimulate, promote, encourage", s:"To foster good health in the city, the mayor started a “Get out and exercise!” campaign."},
        {w:"fractious", p:"adj.", d:"troublesome or irritable", s:"Although the child insisted he wasn’t tired, his fractious behavior—especially his decision to crush his cheese and crackers all over the ﬂoor—convinced everyone present that it was time to put him to bed."},
        {w:"fraught", p:"adj.", d:"ﬁlled or accompanied with (usually used with “with”)", s:"Her glances in his direction were fraught with meaning, though precisely what meaning remained unclear."},
        {w:"frenetic", p:"adj.", d:"frenzied, hectic, frantic", s:"In the hours between night and morning, the frenetic pace of city life slows to a lull."},
        {w:"frivolous", p:"adj.", d:"of little importance, triﬂing", s:"Someday, all that anxiety about whether your zit will disappear before the prom will seem totally frivolous."},
        {w:"frugal", p:"adj.", d:"thrifty, economical", s:"Richard is so frugal that his diet consists almost exclusively of catﬁsh and chicken liver—the two most inexpensive foods in the store."},
        {w:"furtive", p:"adj.", d:"secretive, sly", s:"Jane’s placement of her drugs in her sock drawer was not as furtive as she thought, as the sock drawer is the ﬁrst place most parents look."},
        {w:"garish", p:"adj.", d:"gaudy, in bad taste", s:"Mrs. Watson has poor taste and covers every object in her house with a garish gold lamé."},
        {w:"garrulous", p:"adj.", d:"talkative, wordy", s:"Some talk show hosts are so garrulous that their guests can’t get a word in edgewise."},
        {w:"genial", p:"adj.", d:"friendly, affable", s:"Although he’s been known to behave like a real jerk, I would say that my brother is an overall genial guy."},
        {w:"gluttony", p:"n.", d:"overindulgence in food or drink", s:"Ada’s fried chicken tastes so divine, I don’t know how anyone can call gluttony a sin."},
        {w:"goad", p:"v.", d:"to urge, spur, incite to action", s:"Jim may think he’s not going to ﬁght Billy, but Billy will goad Jim on with insults until he throws a punch."},
        {w:"gourmand", p:"n.", d:"someone fond of eating and drinking", s:"My parents, who used to eat little more than crackers and salad, have become real gourmands in their old age."},
        {w:"grandiloquence", p:"n.", d:"lofty, pompous language", s:"The student thought her grandiloquence would make her sound smart, but neither the class nor the teacher bought it."},
        {w:"grandiose", p:"adj.", d:"on a magniﬁcent or exaggerated scale", s:"Margaret planned a grandiose party, replete with elephants, trapeze artists, and clowns."},
        {w:"gratuitous", p:"adj.", d:"uncalled for, unwarranted", s:"Every morning the guy at the donut shop gives me a gratuitous helping of ketchup packets."},
        {w:"gregarious", p:"adj.", d:"drawn to the company of others, sociable", s:"Well, if you’re not gregarious, I don’t know why you would want to go to a singles party!"},
        {w:"grievous", p:"adj.", d:"injurious, hurtful; serious or grave in nature", s:"Electrocuting the inmate without being sure of his guilt would be a truly grievous mistake."},
        {w:"guile", p:"n.", d:"deceitful, cunning, sly behavior", s:"Because of his great guile, the politician was able to survive scandal after scandal."},
        {w:"hackneyed", p:"adj.", d:"unoriginal, trite", s:"A girl can only hear “I love you” so many times before it begins to sound hackneyed and meaningless."},
        {w:"hallowed", p:"adj.", d:"revered, consecrated", s:"In the hallowed corridors of the cathedral, the disturbed professor felt himself to be at peace."},
        {w:"hapless", p:"adj.", d:"unlucky", s:"My poor, hapless family never seems to pick a sunny week to go on vacation."},
        {w:"harangue", p:"n.", d:"a ranting speech", s:"Everyone had heard the teacher’s harangue about gum chewing in class before."},
        {w:"hardy", p:"adj.", d:"robust, capable of surviving through adverse conditions", s:"I too would have expected the plants to be dead by mid-November, but apparently they’re very hardy."},
        {w:"harrowing", p:"adj.", d:"greatly distressing, vexing", s:"The car crash was a harrowing experience, but I have a feeling that the increase in my insurance premiums will be even more upsetting."},
        {w:"haughty", p:"adj.", d:"disdainfully proud", s:"The superstar’s haughty dismissal of her costars will backﬁre on her someday."},
        {w:"hedonist", p:"n.", d:"one who believes pleasure should be the primary pursuit of humans", s:"Because he’s such a hedonist, I knew Murray would appreciate the 11 cases of wine I bought him for his birthday."},
        {w:"hegemony", p:"n.", d:"domination over others", s:"Britain’s hegemony over its colonies was threatened once nationalist sentiment began to spread around the world."},
        {w:"heinous", p:"adj.", d:"shockingly wicked, repugnant", s:"The killings were made all the more heinous by the fact that the murderer ﬁrst tortured his victims for three days."},
        {w:"heterogeneous", p:"adj.", d:"varied, diverse in character", s:"I hate having only one ﬂavor so I always buy the swirled, or should I say heterogeneous, type of ice cream."},
        {w:"blandish", p:"v.", d:"to coax by using ﬂattery", s:"Rachel’s assistant tried to blandish her into accepting the deal."},
        {w:"blemish", p:"n.", d:"an imperfection, ﬂaw", s:"The dealer agreed to lower the price because of the many blemishes on the surface of the wooden furniture."},
        {w:"blight", p:"n.", d:"a plague, disease", s:"The potato blight destroyed the harvest and bankrupted many families."},
        {w:"boisterous", p:"adj.", d:"loud and full of energy", s:"The candidate won the vote after giving several boisterous speeches on television."},
        {w:"bombastic", p:"adj.", d:"excessively conﬁdent, pompous", s:"The singer’s bombastic performance disgusted the crowd."},
        {w:"boon", p:"n.", d:"a gift or blessing", s:"The good weather has been a boon for many businesses located near the beach."},
        {w:"bourgeois", p:"n.", d:"a middle-class person, capitalist", s:"Many businessmen receive criticism for their bourgeois approach to life."},
        {w:"brazen", p:"adj.", d:"excessively bold, brash", s:"Critics condemned the novelist’s brazen attempt to plagiarize Hemingway’s story."},
        {w:"brusque", p:"adj.", d:"short, abrupt, dismissive", s:"The captain’s brusque manner offended the passengers."},
        {w:"buffet", p:"v.", d:"to strike with force", s:"The strong winds buffeted the ships, threatening to capsize them."},
        {w:"burnish", p:"v.", d:"to polish, shine", s:"His mother asked him to burnish the silverware before setting the table."},
        {w:"buttress", p:"v.", d:"to support, hold up", s:"The column buttresses the roof above the statue."},
        {w:"cacophony", p:"n.", d:"tremendous noise, disharmonious sound", s:"The elementary school orchestra created a cacophony at the recital."},
        {w:"cadence", p:"n.", d:"a rhythm, progression of sound", s:"The pianist used the foot pedal to emphasize the cadence of the sonata."},
        {w:"cajole", p:"v.", d:"to urge, coax", s:"Fred’s buddies cajoled him into attending the bachelor party."},
        {w:"calamity", p:"n.", d:"an event with disastrous consequences", s:"The earthquake in San Francisco was a calamity worse than any other natural disaster in history."},
        {w:"calibrate", p:"v.", d:"to set, standardize", s:"The mechanic calibrated the car’s transmission to make the motor run most efﬁciently."},
        {w:"callous", p:"adj.", d:"harsh, cold, unfeeling", s:"The murderer’s callous lack of remorse shocked the jury."},
        {w:"calumny", p:"n.", d:"an attempt to spoil someone else’s reputation by spreading lies", s:"The local ofﬁcial’s calumny ended up ruining his opponent’s prospect of winning the election."},
        {w:"camaraderie", p:"n.", d:"brotherhood, jovial unity", s:"Camaraderie among employees usually leads to success in business."},
        {w:"candor", p:"n.", d:"honesty, frankness", s:"We were surprised by the candor of the mayor’s speech because he is usually rather evasive."},
        {w:"canny", p:"adj.", d:"shrewd, careful", s:"The canny runner hung at the back of the pack through much of the race to watch the other runners, and then sprinted past them at the end."},
        {w:"canvas", p:"n.", d:"a piece of cloth on which an artist paints", s:"Picasso liked to work on canvas rather than on bare cement."}
    ];

    // Initialize State
    // Progress Levels: 0 = New, 1 = Learned, 2 = Maintained, 3 = Mastered, 4 = Deleted
    let vocabList = rawData.map(item => ({...item, progress: 0}));
    let currentItem = null;
    let selectedOption = null;
    let isAnswered = false;

    // --- 2. Audio Engine (Web Audio API) ---
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    
    function playSound(type) {
        if (audioCtx.state === 'suspended') audioCtx.resume();
        const oscillator = audioCtx.createOscillator();
        const gainNode = audioCtx.createGain();
        oscillator.connect(gainNode);
        gainNode.connect(audioCtx.destination);

        if (type === 'correct') {
            // High pitch ding
            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(600, audioCtx.currentTime);
            oscillator.frequency.exponentialRampToValueAtTime(1200, audioCtx.currentTime + 0.1);
            gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.4);
            oscillator.start();
            oscillator.stop(audioCtx.currentTime + 0.4);
        } else if (type === 'wrong') {
            // Low thud
            oscillator.type = 'sawtooth';
            oscillator.frequency.setValueAtTime(150, audioCtx.currentTime);
            oscillator.frequency.exponentialRampToValueAtTime(80, audioCtx.currentTime + 0.3);
            gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
            oscillator.start();
            oscillator.stop(audioCtx.currentTime + 0.3);
        } else if (type === 'click') {
            // Soft click
            oscillator.type = 'triangle';
            oscillator.frequency.setValueAtTime(300, audioCtx.currentTime);
            gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.05);
            oscillator.start();
            oscillator.stop(audioCtx.currentTime + 0.05);
        }
    }

    // --- 3. Game Logic ---

    function getProgressColor(level) {
        if(level === 0) return "#eee";
        if(level === 1) return "#b8e2f2"; // Light blue
        if(level === 2) return "#ffd900"; // Gold
        return "#58cc02"; // Green
    }

    function generateQuestion() {
        // Filter out completed words (Level 4)
        const activeWords = vocabList.filter(i => i.progress < 4);

        if (activeWords.length === 0) {
            alert("Congratulations! You have mastered all words!");
            return;
        }

        // Pick random word from active list
        currentItem = activeWords[Math.floor(Math.random() * activeWords.length)];

        // Pick 3 distractors
        const otherWords = rawData.filter(w => w.w !== currentItem.w);
        const distractors = [];
        while(distractors.length < 3) {
            const r = otherWords[Math.floor(Math.random() * otherWords.length)];
            if (!distractors.includes(r)) distractors.push(r);
        }

        // Combine and Shuffle
        const options = [currentItem, ...distractors];
        for (let i = options.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [options[i], options[j]] = [options[j], options[i]];
        }

        renderUI(currentItem, options);
    }

    function renderUI(target, options) {
        // Update Stats
        const activeCount = vocabList.filter(i => i.progress < 4).length;
        document.getElementById('remaining-count').innerText = activeCount;
        
        // Calculate overall mastery percentage
        const totalLevels = rawData.length * 4;
        const currentLevels = vocabList.reduce((acc, curr) => acc + curr.progress, 0);
        document.getElementById('mastery-bar').style.width = `${(currentLevels/totalLevels)*100}%`;

        // Render Question
        const badgeLabel = ["New", "Learning", "Maintained", "Mastered"][target.progress];
        const badgeClass = ["badge-new", "badge-new", "badge-maintained", "badge-mastered"][target.progress];
        
        document.getElementById('question-text').innerHTML = 
            ` <br/> <span style="font-size:0.9em; color:#999;">(${target.p})</span> ${target.d} <span class="badge ${badgeClass}">${badgeLabel}</span>`;

        // Render Options
        const container = document.getElementById('options-container');
        container.innerHTML = '';
        
        options.forEach(opt => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.innerText = opt.w;
            btn.onclick = () => selectOption(btn, opt.w);
            container.appendChild(btn);
        });

        // Reset State
        selectedOption = null;
        isAnswered = false;
        document.getElementById('check-btn').innerText = "CHECK";
        document.getElementById('check-btn').disabled = true;
        document.getElementById('check-btn').style.display = 'block'; // Ensure visible
        document.getElementById('feedback-sheet').style.display = 'none';
        document.getElementById('feedback-sheet').className = 'bottom-sheet';
    }

    function selectOption(btnElement, word) {
        if (isAnswered) return;
        playSound('click');
        
        // Remove selected class from others
        document.querySelectorAll('.option-btn').forEach(b => b.classList.remove('selected'));
        
        btnElement.classList.add('selected');
        selectedOption = word;
        document.getElementById('check-btn').disabled = false;
    }

    function checkAnswer() {
        if (!selectedOption || isAnswered) return;
        isAnswered = true;

        const isCorrect = selectedOption === currentItem.w;
        const buttons = document.querySelectorAll('.option-btn');
        const checkBtn = document.getElementById('check-btn');
        const feedbackSheet = document.getElementById('feedback-sheet');

        // Visual Feedback on Buttons
        buttons.forEach(btn => {
            if (btn.innerText === currentItem.w) {
                btn.classList.add('correct');
            } else if (btn.innerText === selectedOption && !isCorrect) {
                btn.classList.add('wrong');
            }
        });

        // Update Data Logic
        if (isCorrect) {
            currentItem.progress++;
            playSound('correct');
            confetti({
                particleCount: 100,
                spread: 70,
                origin: { y: 0.8 },
                colors: ['#58cc02', '#ffffff']
            });
            feedbackSheet.classList.add('correct');
            document.getElementById('feedback-title').innerHTML = '<span style="font-size:1.5em">✓</span> Excellent!';
        } else {
            // Logic: Don't reset progress if wrong (Rule 4)
            playSound('wrong');
            feedbackSheet.classList.add('wrong');
            document.getElementById('feedback-title').innerHTML = '<span style="font-size:1.5em">✖</span> Correct answer: ' + currentItem.w;
        }

        // Show Definition/Sentence
        document.getElementById('feedback-detail').innerText = currentItem.d;
        document.getElementById('feedback-example').innerHTML = `"${currentItem.s}"`;

        // Switch UI to Feedback mode
        checkBtn.style.display = 'none';
        feedbackSheet.style.display = 'flex';
        
        // Focus continue button for keyboard accessibility
        document.getElementById('continue-btn').focus();
    }

    function nextQuestion() {
        generateQuestion();
    }

    // --- 4. Event Listeners ---

    document.getElementById('check-btn').addEventListener('click', checkAnswer);
    
    document.getElementById('continue-btn').addEventListener('click', () => {
        playSound('click');
        nextQuestion();
    });

    // Keyboard support
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
            if (!isAnswered && selectedOption) {
                checkAnswer();
            } else if (isAnswered) {
                playSound('click');
                nextQuestion();
            }
        }
    });

    // Start App
    generateQuestion();

</script>
</body>
</html>
